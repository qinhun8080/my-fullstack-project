{"version":3,"file":"key.js","sources":["key.js"],"sourcesContent":["// [修改] 从 'crypto-js' 引入 HmacSHA1 和 Base64 编码\nimport HmacSHA1 from 'crypto-js/hmac-sha1';\nimport * as encBase64 from 'crypto-js/enc-base64';\n\n// [修改] 使用 'export function' 以支持 ES Module 语法\nexport function createCommonToken(params) {\n\t\n\t// [修改] crypto-js 需要将 Base64 密钥解析为 WordArray\n    const access_key = encBase64.parse(params.author_key);\n\n    const version = params.version;\n    let res = 'userid' + '/' + params.user_id;\n\t// 有效期一年\n    const et = Math.ceil((Date.now() + 365 * 24 * 3600 * 1000) / 1000);   \n    const method = 'sha1';\n\n\t// 待签名的字符串\n    const key = et + \"\\n\" + method + \"\\n\" + res + \"\\n\" + version;\n    \n\t// [修改] 使用 HmacSHA1(key, secret)\n    const hmac = HmacSHA1(key, access_key);\n\t\n\t// [修改] 将 Hmac 结果转换为 Base64 字符串\n\tlet sign = encBase64.stringify(hmac);\n\n\t// URL编码\n    res = encodeURIComponent(res);\n    sign = encodeURIComponent(sign);\n    const token = `version=${version}&res=${res}&et=${et}&method=${method}&sign=${sign}`;\n\n    return token;\n}"],"names":["encBase64.parse","HmacSHA1","encBase64.stringify"],"mappings":";;AAKO,SAAS,kBAAkB,QAAQ;AAGtC,QAAM,aAAaA,cAAAA,iBAAAA,MAAgB,OAAO,UAAU;AAEpD,QAAM,UAAU,OAAO;AACvB,MAAI,MAAM,YAAiB,OAAO;AAElC,QAAM,KAAK,KAAK,MAAM,KAAK,QAAQ,MAAM,KAAK,OAAO,OAAQ,GAAI;AACjE,QAAM,SAAS;AAGf,QAAM,MAAM,KAAK,OAAO,SAAS,OAAO,MAAM,OAAO;AAGrD,QAAM,OAAOC,cAAAA,SAAS,KAAK,UAAU;AAGxC,MAAI,OAAOC,yCAAoB,IAAI;AAGhC,QAAM,mBAAmB,GAAG;AAC5B,SAAO,mBAAmB,IAAI;AAC9B,QAAM,QAAQ,WAAW,OAAO,QAAQ,GAAG,OAAO,EAAE,WAAW,MAAM,SAAS,IAAI;AAElF,SAAO;AACX;;"}