{"version":3,"file":"profile.js","sources":["pages/profile/profile.vue","C:/Users/30302/Documents/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZmlsZS9wcm9maWxlLnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<view class=\"header-card\">\n\t\t\t<view class=\"avatar-section\">\n\t\t\t\t<view class=\"avatar-container\">\n\t\t\t\t\t<image class=\"avatar\" :src=\"fullAvatarUrl\" mode=\"aspectFill\"></image>\n\t\t\t\t\t<view class=\"avatar-border\"></view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"user-info\">\n\t\t\t\t\t<text class=\"nickname\">{{ userInfo.nickname || userInfo.username }}</text>\n\t\t\t\t\t<text class=\"role-tag\">用户ID: {{ userInfo.id }}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<view class=\"edit-btn\" @click=\"goToEdit\">\n\t\t\t\t<text>编辑资料</text>\n\t\t\t\t<uni-icons type=\"forward\" size=\"16\" color=\"#999\"></uni-icons>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<view class=\"info-list card\">\n\t\t\t<view class=\"list-header\">\n\t\t\t\t<text class=\"list-title\">个人信息</text>\n\t\t\t</view>\n\t\t\t<view class=\"list-item\">\n\t\t\t\t<view class=\"item-content\">\n\t\t\t\t\t<view class=\"label-section\">\n\t\t\t\t\t\t<uni-icons type=\"phone\" size=\"18\" color=\"#5a7dff\" class=\"item-icon\"></uni-icons>\n\t\t\t\t\t\t<text class=\"label\">手机号</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<text class=\"value\">{{ userInfo.phone || '未填写' }}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<view class=\"divider\"></view>\n\t\t\t<view class=\"list-item\">\n\t\t\t\t<view class=\"item-content\">\n\t\t\t\t\t<view class=\"label-section\">\n\t\t\t\t\t\t<uni-icons type=\"person\" size=\"18\" color=\"#5a7dff\" class=\"item-icon\"></uni-icons>\n\t\t\t\t\t\t<text class=\"label\">性别</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<text class=\"value\">{{ genderText }}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<view class=\"divider\"></view>\n\t\t\t<view class=\"list-item\">\n\t\t\t\t<view class=\"item-content\">\n\t\t\t\t\t<view class=\"label-section\">\n\t\t\t\t\t\t<uni-icons type=\"calendar\" size=\"18\" color=\"#5a7dff\" class=\"item-icon\"></uni-icons>\n\t\t\t\t\t\t<text class=\"label\">出生日期</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<text class=\"value\">{{ userInfo.birthday || '未填写' }}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<view class=\"action-section\">\n\t\t\t<button class=\"logout-btn\" @click=\"handleLogout\">\n\t\t\t\t<text class=\"btn-text\">退出登录</text>\n\t\t\t</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\t// 替换为你电脑的 IP\n\tconst API_BASE_URL = 'http://127.0.0.1:8081'; \n\tconst DEFAULT_AVATAR = '/static/default-avatar.png'; // 请确保 static 目录下有一张默认图片\n\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tuserInfo: {}\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\t// 计算完整的头像 URL\n\t\t\tfullAvatarUrl() {\n\t\t\t\tif (this.userInfo.avatarUrl) {\n\t\t\t\t\t// 兼容处理：如果数据库存的是完整http链接就不拼接，否则拼接\n\t\t\t\t\tif (this.userInfo.avatarUrl.startsWith('http')) return this.userInfo.avatarUrl;\n\t\t\t\t\t// 数据库存的是 /images/xxx.jpg，我们需要拼接 http://ip:8081\n\t\t\t\t\treturn API_BASE_URL + this.userInfo.avatarUrl;\n\t\t\t\t}\n\t\t\t\treturn DEFAULT_AVATAR;\n\t\t\t},\n\t\t\t// 性别转换\n\t\t\tgenderText() {\n\t\t\t\tconst g = this.userInfo.gender;\n\t\t\t\tif (g === 1) return '男';\n\t\t\t\tif (g === 2) return '女';\n\t\t\t\treturn '保密';\n\t\t\t}\n\t\t},\n\t\tonShow() {\n\t\t\t// 每次进入页面，都去后端拉取最新数据\n\t\t\tthis.fetchLatestUserInfo();\n\t\t},\n\t\tmethods: {\n\t\t\tfetchLatestUserInfo() {\n\t\t\t\t// 1. 获取本地存储的用户ID 和 Token [修改点]\n\t\t\t\tconst localUser = uni.getStorageSync('userInfo');\n\t\t\t\tconst token = uni.getStorageSync('token'); // 获取 Token\n\n\t\t\t\tif (!localUser || !localUser.id) {\n\t\t\t\t\tuni.reLaunch({ url: '/pages/login/login' });\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// 2. 调用后端 /api/user/info 接口\n\t\t\t\tuni.request({\n\t\t\t\t\turl: API_BASE_URL + '/api/user/info',\n\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\tdata: { id: localUser.id },\n\t\t\t\t\t// [修改点] 添加 Header 携带 Token\n\t\t\t\t\theader: {\n\t\t\t\t\t\t'Authorization': token ? 'Bearer ' + token : ''\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\tif (res.data.success) {\n\t\t\t\t\t\t\tthis.userInfo = res.data.data;\n\t\t\t\t\t\t\t// 更新本地缓存，保持同步\n\t\t\t\t\t\t\tuni.setStorageSync('userInfo', this.userInfo);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfail: (err) => {\n\t\t\t\t\t\tconsole.error('获取用户信息失败', err);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tgoToEdit() {\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl: '/pages/profile-edit/profile-edit'\n\t\t\t\t});\n\t\t\t},\n\t\t\thandleLogout() {\n\t\t\t\tuni.showModal({\n\t\t\t\t\ttitle: '提示',\n\t\t\t\t\tcontent: '确定要退出登录吗？',\n\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\t\tuni.removeStorageSync('userInfo');\n\t\t\t\t\t\t\tuni.removeStorageSync('hasLogin');\n\t\t\t\t\t\t\tuni.removeStorageSync('token'); // [修改点] 清除 Token\n\t\t\t\t\t\t\tuni.reLaunch({ url: '/pages/login/login' });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n\tpage { \n\t\tbackground: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%); \n\t\tpadding: 20rpx; \n\t\tbox-sizing: border-box; \n\t\tmin-height: 100vh;\n\t}\n\t\n\t.container {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tmin-height: 100vh;\n\t}\n\t\n\t.card { \n\t\tbackground-color: #fff; \n\t\tborder-radius: 24rpx; \n\t\tpadding: 0;\n\t\tmargin-bottom: 30rpx;\n\t\tbox-shadow: 0 8rpx 30rpx rgba(0, 0, 0, 0.05);\n\t\toverflow: hidden;\n\t\ttransition: transform 0.3s ease, box-shadow 0.3s ease;\n\t}\n\t\n\t.card:active {\n\t\ttransform: translateY(4rpx);\n\t\tbox-shadow: 0 4rpx 15rpx rgba(0, 0, 0, 0.05);\n\t}\n\t\n\t/* 顶部用户信息卡片 */\n\t.header-card {\n\t\t@extend .card;\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tpadding: 40rpx 30rpx;\n\t\tbackground: linear-gradient(135deg, #6a85b6 0%, #bac8e0 100%);\n\t\tcolor: white;\n\t\tposition: relative;\n\t\toverflow: visible;\n\t}\n\t\n\t.avatar-section {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tflex: 1;\n\t}\n\t\n\t.avatar-container {\n\t\tposition: relative;\n\t\tmargin-right: 30rpx;\n\t}\n\t\n\t.avatar {\n\t\twidth: 120rpx;\n\t\theight: 120rpx;\n\t\tborder-radius: 50%;\n\t\tbackground: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);\n\t\tmargin-right: 30rpx;\n\t\tz-index: 2;\n\t\tposition: relative;\n\t\tborder: 4rpx solid rgba(255, 255, 255, 0.3);\n\t\tbox-shadow: 0 8rpx 20rpx rgba(0, 0, 0, 0.1);\n\t}\n\t\n\t.avatar-border {\n\t\tposition: absolute;\n\t\ttop: -6rpx;\n\t\tleft: -6rpx;\n\t\twidth: 132rpx;\n\t\theight: 132rpx;\n\t\tborder-radius: 50%;\n\t\tbackground: linear-gradient(135deg, rgba(255,255,255,0.6) 0%, rgba(255,255,255,0.2) 100%);\n\t\tz-index: 1;\n\t}\n\t\n\t.user-info {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tflex: 1;\n\t}\n\t\n\t.nickname { \n\t\tfont-size: 36rpx; \n\t\tfont-weight: bold; \n\t\tmargin-bottom: 10rpx; \n\t\ttext-shadow: 0 2rpx 4rpx rgba(0, 0, 0, 0.1);\n\t}\n\t\n\t.role-tag { \n\t\tfont-size: 24rpx; \n\t\topacity: 0.9;\n\t\tbackground: rgba(255, 255, 255, 0.2);\n\t\tpadding: 6rpx 16rpx;\n\t\tborder-radius: 20rpx;\n\t\talign-self: flex-start;\n\t}\n\t\n\t.edit-btn { \n\t\tdisplay: flex; \n\t\talign-items: center; \n\t\tfont-size: 26rpx; \n\t\tbackground: rgba(255, 255, 255, 0.2);\n\t\tpadding: 12rpx 20rpx;\n\t\tborder-radius: 30rpx;\n\t\tbackdrop-filter: blur(10px);\n\t\ttransition: all 0.3s ease;\n\t}\n\t\n\t.edit-btn:active {\n\t\tbackground: rgba(255, 255, 255, 0.3);\n\t\ttransform: scale(0.95);\n\t}\n\t\n\t/* 信息列表 */\n\t.info-list {\n\t\tpadding: 0;\n\t}\n\t\n\t.list-header {\n\t\tpadding: 30rpx 30rpx 20rpx;\n\t\tborder-bottom: 1rpx solid #f0f0f0;\n\t}\n\t\n\t.list-title {\n\t\tfont-size: 32rpx;\n\t\tfont-weight: 600;\n\t\tcolor: #333;\n\t}\n\t\n\t.list-item {\n\t\tpadding: 0 30rpx;\n\t}\n\t\n\t.item-content {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\theight: 100rpx;\n\t}\n\t\n\t.label-section {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t}\n\t\n\t.item-icon {\n\t\tmargin-right: 20rpx;\n\t}\n\t\n\t.label { \n\t\tfont-size: 30rpx; \n\t\tcolor: #333; \n\t\tfont-weight: 500;\n\t}\n\t\n\t.value { \n\t\tfont-size: 30rpx; \n\t\tcolor: #666; \n\t}\n\t\n\t.divider { \n\t\theight: 1rpx; \n\t\tbackground: linear-gradient(to right, #f0f0f0 0%, #e0e0e0 50%, #f0f0f0 100%);\n\t\tmargin: 0 30rpx;\n\t}\n\t\n\t/* 操作区域 */\n\t.action-section {\n\t\tmargin-top: auto;\n\t\tpadding: 40rpx 0;\n\t}\n\t\n\t.logout-btn {\n\t\tbackground: linear-gradient(135deg, #ff6b6b 0%, #ff4757 100%);\n\t\tcolor: white;\n\t\tfont-size: 32rpx;\n\t\tborder-radius: 16rpx;\n\t\tbox-shadow: 0 6rpx 20rpx rgba(255, 107, 107, 0.3);\n\t\tborder: none;\n\t\theight: 90rpx;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\ttransition: all 0.3s ease;\n\t\tposition: relative;\n\t\toverflow: hidden;\n\t}\n\t\n\t.logout-btn::after {\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: -100%;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tbackground: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);\n\t\ttransition: left 0.5s;\n\t}\n\t\n\t.logout-btn:active::after {\n\t\tleft: 100%;\n\t}\n\t\n\t.logout-btn:active {\n\t\ttransform: translateY(4rpx);\n\t\tbox-shadow: 0 2rpx 10rpx rgba(255, 107, 107, 0.3);\n\t}\n\t\n\t.btn-text {\n\t\tfont-weight: 500;\n\t\tletter-spacing: 2rpx;\n\t}\n</style>","import MiniProgramPage from 'D:/my-fullstack-project/test1/pages/profile/profile.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;AAgEC,MAAM,eAAe;AACrB,MAAM,iBAAiB;AAEvB,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,UAAU,CAAC;AAAA,IACZ;AAAA,EACA;AAAA,EACD,UAAU;AAAA;AAAA,IAET,gBAAgB;AACf,UAAI,KAAK,SAAS,WAAW;AAE5B,YAAI,KAAK,SAAS,UAAU,WAAW,MAAM;AAAG,iBAAO,KAAK,SAAS;AAErE,eAAO,eAAe,KAAK,SAAS;AAAA,MACrC;AACA,aAAO;AAAA,IACP;AAAA;AAAA,IAED,aAAa;AACZ,YAAM,IAAI,KAAK,SAAS;AACxB,UAAI,MAAM;AAAG,eAAO;AACpB,UAAI,MAAM;AAAG,eAAO;AACpB,aAAO;AAAA,IACR;AAAA,EACA;AAAA,EACD,SAAS;AAER,SAAK,oBAAmB;AAAA,EACxB;AAAA,EACD,SAAS;AAAA,IACR,sBAAsB;AAErB,YAAM,YAAYA,cAAAA,MAAI,eAAe,UAAU;AAC/C,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AAExC,UAAI,CAAC,aAAa,CAAC,UAAU,IAAI;AAChCA,sBAAAA,MAAI,SAAS,EAAE,KAAK,qBAAsB,CAAA;AAC1C;AAAA,MACD;AAGAA,oBAAAA,MAAI,QAAQ;AAAA,QACX,KAAK,eAAe;AAAA,QACpB,QAAQ;AAAA,QACR,MAAM,EAAE,IAAI,UAAU,GAAI;AAAA;AAAA,QAE1B,QAAQ;AAAA,UACP,iBAAiB,QAAQ,YAAY,QAAQ;AAAA,QAC7C;AAAA,QACD,SAAS,CAAC,QAAQ;AACjB,cAAI,IAAI,KAAK,SAAS;AACrB,iBAAK,WAAW,IAAI,KAAK;AAEzBA,0BAAAA,MAAI,eAAe,YAAY,KAAK,QAAQ;AAAA,UAC7C;AAAA,QACA;AAAA,QACD,MAAM,CAAC,QAAQ;AACdA,wBAAc,MAAA,MAAA,SAAA,oCAAA,YAAY,GAAG;AAAA,QAC9B;AAAA,MACD,CAAC;AAAA,IACD;AAAA,IACD,WAAW;AACVA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK;AAAA,MACN,CAAC;AAAA,IACD;AAAA,IACD,eAAe;AACdA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AACjB,cAAI,IAAI,SAAS;AAChBA,gCAAI,kBAAkB,UAAU;AAChCA,gCAAI,kBAAkB,UAAU;AAChCA,gCAAI,kBAAkB,OAAO;AAC7BA,0BAAAA,MAAI,SAAS,EAAE,KAAK,qBAAsB,CAAA;AAAA,UAC3C;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnJD,GAAG,WAAW,eAAe;"}