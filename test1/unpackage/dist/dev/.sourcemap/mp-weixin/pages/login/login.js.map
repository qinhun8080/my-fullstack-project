{"version":3,"file":"login.js","sources":["pages/login/login.vue","C:/Users/30302/Documents/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <view class=\"login-card\">\n      <view class=\"header\">\n        <text class=\"title\">欢迎登录</text>\n      </view>\n\n      <view class=\"form-area\">\n        \n        <view class=\"input-group\">\n          <text class=\"label\">用户名</text>\n          <input \n            class=\"input-field\" \n            v-model=\"username\" \n            placeholder=\"请输入用户名\" \n            placeholder-class=\"placeholder-style\" \n          />\n        </view>\n\n        <view class=\"input-group\">\n          <text class=\"label\">密码</text>\n          <view class=\"password-wrapper\">\n            <input \n              class=\"input-field\" \n              :password=\"!showPassword\" \n              v-model=\"password\" \n              placeholder=\"请输入密码\" \n              placeholder-class=\"placeholder-style\" \n            />\n            <view class=\"password-toggle\" @click=\"togglePasswordVisibility\">\n              <uni-icons :type=\"showPassword ? 'eye-filled' : 'eye-slash-filled'\" size=\"20\" color=\"#6b7280\"></uni-icons>\n            </view>\n          </view>\n        </view>\n\n        <view class=\"options-grid\">\n         <view class=\"remember-me\">\n           <checkbox-group @change=\"handleCheckboxChange\">\n             <label class=\"checkbox-label\">\n               <checkbox value=\"1\" :checked=\"rememberMe\" style=\"transform:scale(0.7)\" color=\"#6366f1\" />\n               <text class=\"checkbox-text\">记住我</text>\n             </label>\n           </checkbox-group>\n         </view>\n          <view class=\"forgot-link\" @click=\"goToForgotPassword\">\n            <text>忘记密码？</text>\n          </view>\n        </view>\n\n        <button \n          class=\"login-btn\" \n          @click=\"handleLogin\" \n          :disabled=\"loggingIn\" \n          :class=\"{loading: loggingIn}\"\n        >\n          {{ loggingIn ? '登 录 中...' : '登 录' }}\n        </button>\n\n        <view class=\"footer-links\">\n          <text class=\"footer-link\" @click=\"goToRegister\">注册账号</text>\n          \n          <view class=\"footer-btn\" @click=\"showPasswordTip\">\n            <uni-icons type=\"star\" size=\"14\" color=\"#6366f1\"></uni-icons>\n            <text class=\"footer-link\">密码建议</text>\n          </view>\n        </view>\n\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\n  // 确保 IP 地址正确\n  const API_BASE_URL = 'http://127.0.0.1:8081/api';\n\n  export default {\n    data() {\n      return {\n        username: '',\n        password: '',\n        loggingIn: false,\n        showPassword: false,\n        rememberMe: false\n      }\n    },\n    methods: {\n      togglePasswordVisibility() {\n        this.showPassword = !this.showPassword;\n      },\n      handleCheckboxChange(e) {\n          // 你的原有逻辑：判断数组长度\n          this.rememberMe = e.detail.value.length > 0;\n          console.log('记住我状态:', this.rememberMe);\n      },\n      showPasswordTip() {\n        uni.showToast({ title: '密码建议功能开发中', icon: 'none' });\n      },\n      handleLogin() {\n        if (!this.username || !this.password) {\n          uni.showToast({ title: '请输入账号和密码', icon: 'none' });\n          return;\n        }\n\n        this.loggingIn = true;\n\n        uni.request({\n          url: API_BASE_URL + '/login',\n          method: 'POST',\n          // [原有逻辑已恢复] 保持 Session/Cookie 传递能力\n          withCredentials: true, \n          header: {\n             // 显式指定 JSON，防止部分环境默认表单提交\n            'content-type': 'application/json'\n          },\n          data: {\n            username: this.username,\n            password: this.password,\n            // [原有逻辑已恢复] 传递记住我状态\n            rememberMe: this.rememberMe \n          },\n          success: (res) => {\n            console.log('登录结果:', res.data);\n            if (res.data && res.data.success) {\n              \n              // 1. [新增] 必须存储 Token 才能让后续接口鉴权通过\n              if (res.data.token) {\n                 uni.setStorageSync('token', res.data.token);\n              }\n              \n              // 2. 你的原有存储逻辑\n              uni.setStorageSync('hasLogin', true);\n              uni.setStorageSync('userInfo', res.data.userData);\n              \n              uni.showToast({ title: '登录成功', icon: 'success' });\n              \n              setTimeout(() => {\n                uni.switchTab({\n                  url: '/pages/index/index'\n                });\n              }, 1000);\n            } else {\n              uni.showToast({\n                title: res.data.message || '登录失败',\n                icon: 'none'\n              });\n            }\n          },\n          fail: (err) => {\n            console.error('请求失败:', err);\n            uni.showToast({ title: '无法连接服务器', icon: 'none' });\n          },\n          complete: () => {\n            this.loggingIn = false;\n          },\n        });\n      },\n      goToRegister() {\n          uni.navigateTo({ url: '/pages/login/register' });\n      },\n      goToForgotPassword() {\n          uni.navigateTo({ url: '/pages/login/forgot-password' });\n      },\n    }\n  }\n</script>\n\n<style lang=\"scss\" scoped>\n  /* 全局容器：模拟 Web 版的 body 背景 */\n  .container {\n    min-height: 100vh;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background-color: #f0f2f5; /* 灰色背景 */\n    padding: 20rpx;\n  }\n\n  /* 登录卡片：白色、圆角、阴影 */\n  .login-card {\n    background: #ffffff;\n    width: 100%;\n    max-width: 650rpx; /* 限制最大宽度，类似 Web 版的 width: 420px */\n    padding: 60rpx 40rpx;\n    border-radius: 24rpx;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05); /* 轻柔阴影 */\n  }\n\n  .header {\n    margin-bottom: 40rpx;\n    text-align: center;\n  }\n\n  .title {\n    font-size: 40rpx;\n    font-weight: bold;\n    color: #111827; /* 深黑色标题 */\n  }\n\n  /* 输入框组 */\n  .input-group {\n    margin-bottom: 30rpx;\n  }\n\n  .label {\n    display: block;\n    margin-bottom: 12rpx;\n    font-size: 28rpx;\n    font-weight: 500;\n    color: #6b7280; /* 标签灰色 */\n  }\n\n  /* 输入框样式：方框、边框 */\n  .input-field {\n    width: 100%;\n    height: 90rpx;\n    padding: 0 20rpx;\n    border: 2rpx solid #d1d5db; /* 浅灰边框 */\n    border-radius: 12rpx;\n    font-size: 30rpx;\n    color: #333;\n    box-sizing: border-box; /* 确保 padding 不撑大宽度 */\n    background-color: #fff;\n  }\n\n  .placeholder-style {\n    color: #9ca3af;\n  }\n\n  /* 密码框包装器，用于定位眼睛图标 */\n  .password-wrapper {\n    position: relative;\n    width: 100%;\n  }\n\n  .password-toggle {\n    position: absolute;\n    right: 20rpx;\n    top: 50%;\n    transform: translateY(-50%);\n    z-index: 10;\n    padding: 10rpx;\n  }\n\n  /* 选项行：记住我 - 忘记密码 */\n  .options-grid {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 40rpx;\n  }\n\n  .checkbox-label {\n    display: flex;\n    align-items: center;\n  }\n\n  .checkbox-text {\n    font-size: 28rpx;\n    color: #6b7280;\n    margin-left: 4rpx;\n  }\n\n  .forgot-link {\n    text {\n      font-size: 28rpx;\n      color: #6366f1; /* 靛蓝色链接 */\n      font-weight: 500;\n    }\n  }\n\n  /* 登录按钮 */\n  .login-btn {\n    background-color: #6366f1; /* 纯色背景，不再是渐变 */\n    color: white;\n    font-size: 32rpx;\n    font-weight: 600;\n    border-radius: 16rpx;\n    height: 96rpx;\n    line-height: 96rpx;\n    border: none;\n    margin-bottom: 30rpx;\n    transition: opacity 0.2s;\n\n    &:active {\n      opacity: 0.9;\n    }\n\n    &.loading {\n      opacity: 0.7;\n    }\n  }\n\n  /* 底部链接 */\n  .footer-links {\n    display: flex;\n    justify-content: center;\n    gap: 30rpx;\n    margin-top: 10rpx;\n  }\n\n  .footer-btn {\n    display: flex;\n    align-items: center;\n    gap: 6rpx;\n  }\n\n  .footer-link {\n    font-size: 28rpx;\n    color: #6366f1;\n    font-weight: 500;\n  }\n</style>","import MiniProgramPage from 'D:/my-fullstack-project/test1/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;AA0EE,MAAM,eAAe;AAErB,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,UAAU;AAAA,MACV,UAAU;AAAA,MACV,WAAW;AAAA,MACX,cAAc;AAAA,MACd,YAAY;AAAA,IACd;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACP,2BAA2B;AACzB,WAAK,eAAe,CAAC,KAAK;AAAA,IAC3B;AAAA,IACD,qBAAqB,GAAG;AAEpB,WAAK,aAAa,EAAE,OAAO,MAAM,SAAS;AAC1CA,oBAAA,MAAA,MAAA,OAAA,+BAAY,UAAU,KAAK,UAAU;AAAA,IACxC;AAAA,IACD,kBAAkB;AAChBA,oBAAG,MAAC,UAAU,EAAE,OAAO,aAAa,MAAM,OAAK,CAAG;AAAA,IACnD;AAAA,IACD,cAAc;AACZ,UAAI,CAAC,KAAK,YAAY,CAAC,KAAK,UAAU;AACpCA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,OAAK,CAAG;AACjD;AAAA,MACF;AAEA,WAAK,YAAY;AAEjBA,oBAAAA,MAAI,QAAQ;AAAA,QACV,KAAK,eAAe;AAAA,QACpB,QAAQ;AAAA;AAAA,QAER,iBAAiB;AAAA,QACjB,QAAQ;AAAA;AAAA,UAEN,gBAAgB;AAAA,QACjB;AAAA,QACD,MAAM;AAAA,UACJ,UAAU,KAAK;AAAA,UACf,UAAU,KAAK;AAAA;AAAA,UAEf,YAAY,KAAK;AAAA,QAClB;AAAA,QACD,SAAS,CAAC,QAAQ;AAChBA,wBAAA,MAAA,MAAA,OAAA,gCAAY,SAAS,IAAI,IAAI;AAC7B,cAAI,IAAI,QAAQ,IAAI,KAAK,SAAS;AAGhC,gBAAI,IAAI,KAAK,OAAO;AACjBA,4BAAG,MAAC,eAAe,SAAS,IAAI,KAAK,KAAK;AAAA,YAC7C;AAGAA,0BAAAA,MAAI,eAAe,YAAY,IAAI;AACnCA,0BAAG,MAAC,eAAe,YAAY,IAAI,KAAK,QAAQ;AAEhDA,0BAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,UAAQ,CAAG;AAEhD,uBAAW,MAAM;AACfA,4BAAAA,MAAI,UAAU;AAAA,gBACZ,KAAK;AAAA,cACP,CAAC;AAAA,YACF,GAAE,GAAI;AAAA,iBACF;AACLA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO,IAAI,KAAK,WAAW;AAAA,cAC3B,MAAM;AAAA,YACR,CAAC;AAAA,UACH;AAAA,QACD;AAAA,QACD,MAAM,CAAC,QAAQ;AACbA,wBAAA,MAAA,MAAA,SAAA,gCAAc,SAAS,GAAG;AAC1BA,wBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,OAAK,CAAG;AAAA,QACjD;AAAA,QACD,UAAU,MAAM;AACd,eAAK,YAAY;AAAA,QAClB;AAAA,MACH,CAAC;AAAA,IACF;AAAA,IACD,eAAe;AACXA,oBAAAA,MAAI,WAAW,EAAE,KAAK,wBAAyB,CAAA;AAAA,IAClD;AAAA,IACD,qBAAqB;AACjBA,oBAAAA,MAAI,WAAW,EAAE,KAAK,+BAAgC,CAAA;AAAA,IACzD;AAAA,EACH;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnKF,GAAG,WAAW,eAAe;"}