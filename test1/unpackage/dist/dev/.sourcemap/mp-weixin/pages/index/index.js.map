{"version":3,"file":"index.js","sources":["pages/index/index.vue","C:/Users/30302/Documents/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t\n\t\t<view class=\"top-bar\">\n\t\t\t<view class=\"location\">\n\t\t\t\t<text>定位</text>\n\t\t\t\t<uni-icons type=\"map-pin-ellipse\" size=\"22\" color=\"#333\" style=\"margin-left: 4rpx;\"></uni-icons>\n\t\t\t</view>\n\t\t\t<view class=\"search-box\">\n\t\t\t\t<uni-icons type=\"search\" size=\"18\" color=\"#999\"></uni-icons>\n\t\t\t\t<text class=\"search-placeholder\">搜索</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<view class=\"card info-card\">\n\t\t\t<view class=\"left-info\">\n\t\t\t\t<view class=\"info-line\">设备状态 ({{ deviceStatus }})</view>\n\t\t\t\t<view class=\"info-line\">当前温度</view>\n\t\t\t\t<view class=\"data-value temp-value\">\n\t\t\t\t\t{{ temp }} <text v-if=\"temp !== '--'\" class=\"unit\">°C</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"right-data\">\n\t\t\t\t<view class=\"info-line\">当前湿度</view>\n\t\t\t\t<uni-icons type=\"droplet\" size=\"34\" color=\"#a0cfff\"></uni-icons>\n\t\t\t\t<view class=\"data-value humi-value\">\n\t\t\t\t\t{{ humi }} <text v-if=\"humi !== '--'\" class=\"unit\">%RH</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<view class=\"grid-container\">\n\t\t\t<view class=\"grid-item card\">\n\t\t\t\t<text class=\"grid-text\">查看位置</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"grid-item card\">\n\t\t\t\t<text class=\"grid-text\">超声波测距</text>\n\t\t\t\t<view class=\"grid-value\" :class=\"{ 'danger-text': isDanger }\">\n\t\t\t\t\t{{ distance }} <text v-if=\"distance !== '--'\" style=\"font-size: 24rpx; color: #666;\">cm</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"grid-item card\" @click=\"openCallModal\">\n\t\t\t\t<text class=\"grid-text\">呼叫</text>\n\t\t\t\t<uni-icons type=\"phone-filled\" size=\"24\" color=\"#3498db\" style=\"margin-top: 10rpx;\"></uni-icons>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"grid-item card warning-grid\" @click=\"openHistoryModal\">\n\t\t\t\t<text class=\"grid-text\">历史预警</text>\n\t\t\t\t<view v-if=\"historyAlerts.length > 0\" class=\"big-alert-num\">\n\t\t\t\t\t{{ historyAlerts.length }}\n\t\t\t\t</view>\n\t\t\t\t<text v-else style=\"font-size: 24rpx; color: #ccc; margin-top: 10rpx;\">无记录</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"modal-mask\" v-if=\"showHistoryModal || showCallModal\" @click=\"closeAllModals\"></view>\n\t\t\n\t\t<view class=\"modal-content\" v-if=\"showHistoryModal\">\n\t\t\t<view class=\"modal-header\">\n\t\t\t\t<text class=\"modal-title\">危险预警记录</text>\n\t\t\t\t<uni-icons type=\"closeempty\" size=\"24\" color=\"#999\" @click=\"closeAllModals\"></uni-icons>\n\t\t\t</view>\n\t\t\t<scroll-view scroll-y=\"true\" class=\"modal-body\">\n\t\t\t\t<view v-if=\"historyAlerts.length === 0\" class=\"empty-tip\">暂无危险预警</view>\n\t\t\t\t<view v-for=\"(item, index) in historyAlerts\" :key=\"index\" class=\"alert-item\">\n\t\t\t\t\t<uni-icons type=\"info-filled\" color=\"#ff4d4f\" size=\"18\"></uni-icons>\n\t\t\t\t\t<text class=\"alert-text\">{{ item }}</text>\n\t\t\t\t</view>\n\t\t\t</scroll-view>\n\t\t\t<view class=\"modal-footer\">\n\t\t\t\t<button class=\"close-btn\" @click=\"closeAllModals\">关闭</button>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"modal-content call-modal-box\" v-if=\"showCallModal\">\n\t\t\t<view class=\"call-avatar-area\">\n\t\t\t\t<view class=\"avatar-circle\">\n\t\t\t\t\t<uni-icons type=\"person-filled\" size=\"50\" color=\"#fff\"></uni-icons>\n\t\t\t\t</view>\n\t\t\t\t<text class=\"call-name\">管理员中心</text>\n\t\t\t\t<text class=\"call-status\">正在呼叫...</text>\n\t\t\t</view>\n\t\t\t<view class=\"call-actions\">\n\t\t\t\t<view class=\"hangup-btn\" @click=\"closeAllModals\">\n\t\t\t\t\t<uni-icons type=\"phone-filled\" size=\"30\" color=\"#fff\"></uni-icons>\n\t\t\t\t</view>\n\t\t\t\t<text style=\"margin-top: 10rpx; color: #666; font-size: 24rpx;\">挂断</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t</view>\n</template>\n\n<script>\n\tconst API_BASE_URL = 'http://127.0.0.1:8081/api';\n\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\ttemp: '--', \n\t\t\t\thumi: '--',\n\t\t\t\tdistance: '--', \n\t\t\t\tdeviceStatus: '查询中...',\n\t\t\t\thistoryAlerts: [], \n\t\t\t\tshowHistoryModal: false,\n\t\t\t\tshowCallModal: false,\n\t\t\t\tdataTimer: null\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\tisDanger() {\n\t\t\t\tconst val = parseFloat(this.distance);\n\t\t\t\treturn !isNaN(val) && val < 30;\n\t\t\t}\n\t\t},\n\t\tonShow() {\n\t\t\tthis.fetchBackendData();\n\t\t\tthis.dataTimer = setInterval(() => {\n\t\t\t\tthis.fetchBackendData(); \n\t\t\t}, 5000); \n\t\t},\n\t\tonHide() {\n\t\t\tif (this.dataTimer) {\n\t\t\t\tclearInterval(this.dataTimer);\n\t\t\t\tthis.dataTimer = null;\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\topenHistoryModal() {\n\t\t\t\tthis.showHistoryModal = true;\n\t\t\t\tthis.showCallModal = false;\n\t\t\t},\n\t\t\topenCallModal() {\n\t\t\t\tthis.showCallModal = true;\n\t\t\t\tthis.showHistoryModal = false;\n\t\t\t},\n\t\t\tcloseAllModals() {\n\t\t\t\tthis.showHistoryModal = false;\n\t\t\t\tthis.showCallModal = false;\n\t\t\t},\n\t\t\tfetchBackendData() {\n\t\t\t\tuni.request({\n\t\t\t\t\turl: API_BASE_URL + '/device-data', \n\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\tif (res.data) {\n\t\t\t\t\t\t\tthis.deviceStatus = res.data.deviceStatus || 'N/A';\n\t\t\t\t\t\t\tthis.temp = res.data.temp;\n\t\t\t\t\t\t\tthis.humi = res.data.humi;\n\t\t\t\t\t\t\tthis.distance = res.data.distance; \n\t\t\t\t\t\t\tif (res.data.historyAlerts) {\n\t\t\t\t\t\t\t\tthis.historyAlerts = res.data.historyAlerts;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfail: (err) => {\n\t\t\t\t\t\tconsole.error(\"API请求失败:\", err);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n\t.container { min-height: 100vh; }\n\t.top-bar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25rpx; padding: 0 10rpx; }\n\t.location { display: flex; align-items: center; font-size: 34rpx; font-weight: bold; }\n\t.search-box { display: flex; align-items: center; background-color: #ffffff; border-radius: 30rpx; padding: 12rpx 24rpx; flex: 1; margin-left: 20rpx; box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05); }\n\t.search-placeholder { margin-left: 10rpx; color: #999; font-size: 30rpx; }\n\t\n\t/* 卡片样式 */\n\t.info-card { display: flex; justify-content: space-between; align-items: center; padding-top: 20rpx; padding-bottom: 20rpx; }\n\t.left-info .info-line, .right-data .info-line { font-size: 34rpx; color: #666; line-height: 1.6; }\n\t\n\t/* 数值样式 */\n\t.data-value { font-size: 68rpx; font-weight: bold; margin-top: 18rpx; .unit { font-size: 36rpx; font-weight: normal; margin-left: 8rpx; } }\n\t.temp-value { color: #f39c12; }\n\t.humi-value { color: #3498db; }\n\t\n\t/* 右侧数据列布局 */\n\t.right-data { display: flex; flex-direction: column; align-items: center; font-size: 26rpx; color: #666; uni-icons { margin: 18rpx 0; } }\n\n\t/* 九宫格样式 */\n\t.grid-container { display: flex; flex-wrap: wrap; justify-content: space-between; }\n\t.grid-item { \n\t\twidth: calc(50% - 10rpx); \n\t\tdisplay: flex; \n\t\tflex-direction: column; \n\t\talign-items: center; \n\t\tjustify-content: center; \n\t\tmin-height: 180rpx; \n\t\t.grid-text { font-size: 36rpx; font-weight: bold; color: #333; }\n\t}\n\t\n\t/* [新增] 九宫格里的距离数值样式 */\n\t.grid-value {\n\t\tfont-size: 40rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #333;\n\t\tmargin-top: 10rpx;\n\t}\n\t.danger-text { color: #ff4d4f !important; }\n\n\t.warning-grid { border-left: 10rpx solid #ff4d4f; }\n\t.big-alert-num { font-size: 60rpx; font-weight: bold; color: #ff4d4f; margin-top: 10rpx; line-height: 1; }\n\n\t/* 弹窗通用样式 */\n\t.modal-mask { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 999; }\n\t.modal-content { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; background-color: #fff; border-radius: 20rpx; z-index: 1000; padding: 30rpx; box-shadow: 0 10rpx 30rpx rgba(0,0,0,0.2); }\n\t\n\t.modal-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 20rpx; border-bottom: 1rpx solid #eee; margin-bottom: 20rpx; }\n\t.modal-title { font-size: 34rpx; font-weight: bold; color: #333; }\n\t.modal-body { max-height: 500rpx; min-height: 200rpx; }\n\t.alert-item { display: flex; align-items: flex-start; padding: 15rpx 0; border-bottom: 1rpx solid #f9f9f9; }\n\t.alert-text { font-size: 28rpx; color: #555; margin-left: 15rpx; line-height: 1.4; }\n\t.empty-tip { text-align: center; color: #999; margin-top: 80rpx; }\n\t.modal-footer { margin-top: 30rpx; }\n\t.close-btn { background-color: #f5f5f5; color: #666; font-size: 30rpx; border-radius: 40rpx; }\n\t.close-btn::after { border: none; }\n\n\t/* 呼叫弹窗专属 */\n\t.call-modal-box { display: flex; flex-direction: column; align-items: center; padding: 50rpx 30rpx; }\n\t.call-avatar-area { display: flex; flex-direction: column; align-items: center; margin-bottom: 60rpx; }\n\t.avatar-circle { width: 120rpx; height: 120rpx; background-color: #ddd; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20rpx; }\n\t.call-name { font-size: 36rpx; font-weight: bold; color: #333; margin-bottom: 10rpx; }\n\t.call-status { font-size: 28rpx; color: #666; }\n\t.call-actions { display: flex; flex-direction: column; align-items: center; }\n\t.hangup-btn { width: 120rpx; height: 120rpx; background-color: #ff4d4f; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4rpx 12rpx rgba(255, 77, 79, 0.4); }\n\t.hangup-btn:active { background-color: #d9363e; }\n</style>","import MiniProgramPage from 'D:/大创/test1/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;AAiGC,MAAM,eAAe;AAErB,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,MACV,cAAc;AAAA,MACd,eAAe,CAAE;AAAA,MACjB,kBAAkB;AAAA,MAClB,eAAe;AAAA,MACf,WAAW;AAAA,IACZ;AAAA,EACA;AAAA,EACD,UAAU;AAAA,IACT,WAAW;AACV,YAAM,MAAM,WAAW,KAAK,QAAQ;AACpC,aAAO,CAAC,MAAM,GAAG,KAAK,MAAM;AAAA,IAC7B;AAAA,EACA;AAAA,EACD,SAAS;AACR,SAAK,iBAAgB;AACrB,SAAK,YAAY,YAAY,MAAM;AAClC,WAAK,iBAAgB;AAAA,IACrB,GAAE,GAAI;AAAA,EACP;AAAA,EACD,SAAS;AACR,QAAI,KAAK,WAAW;AACnB,oBAAc,KAAK,SAAS;AAC5B,WAAK,YAAY;AAAA,IAClB;AAAA,EACA;AAAA,EACD,SAAS;AAAA,IACR,mBAAmB;AAClB,WAAK,mBAAmB;AACxB,WAAK,gBAAgB;AAAA,IACrB;AAAA,IACD,gBAAgB;AACf,WAAK,gBAAgB;AACrB,WAAK,mBAAmB;AAAA,IACxB;AAAA,IACD,iBAAiB;AAChB,WAAK,mBAAmB;AACxB,WAAK,gBAAgB;AAAA,IACrB;AAAA,IACD,mBAAmB;AAClBA,oBAAAA,MAAI,QAAQ;AAAA,QACX,KAAK,eAAe;AAAA,QACpB,QAAQ;AAAA,QACR,SAAS,CAAC,QAAQ;AACjB,cAAI,IAAI,MAAM;AACb,iBAAK,eAAe,IAAI,KAAK,gBAAgB;AAC7C,iBAAK,OAAO,IAAI,KAAK;AACrB,iBAAK,OAAO,IAAI,KAAK;AACrB,iBAAK,WAAW,IAAI,KAAK;AACzB,gBAAI,IAAI,KAAK,eAAe;AAC3B,mBAAK,gBAAgB,IAAI,KAAK;AAAA,YAC/B;AAAA,UACD;AAAA,QACA;AAAA,QACD,MAAM,CAAC,QAAQ;AACdA,wBAAc,MAAA,MAAA,SAAA,gCAAA,YAAY,GAAG;AAAA,QAC9B;AAAA,MACD,CAAC;AAAA,IACF;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnKD,GAAG,WAAW,eAAe;"}